<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>University of Calgary - Academic Planning Navigator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f0f0f0;
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            width: 100%;
            background: white;
            min-height: 100vh;
        }

        .header {
            background: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #e0e0e0;
        }

        .header h1 { font-size: 14px; font-weight: 600; }
        .header-title { font-size: 16px; color: #333; }

        .student-banner {
            background: linear-gradient(135deg,#c41e3a 0%,#8b1529 100%);
            color: white;
            padding: 20px 30px;
        }

        .student-info { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
        .student-name { font-size: 24px; font-weight: bold; }
        .student-details { font-size: 13px; opacity: 0.95; }
        .gpa-info { text-align: right; }
        .gpa { font-size: 14px; margin-bottom: 2px; }
        .credits { font-size: 13px; }

        .progress-bar { height: 8px; background: transparent; border-radius: 4px; overflow: hidden; width: 100%; display:flex; }
        .progress-fill { height: 100%; transition: width 0.3s; }
        .progress-fill.completed { background: linear-gradient(90deg,#4caf50 0%,#8bc34a 100%); }
        .progress-fill.in-progress { background: linear-gradient(90deg,#ffd54f 0%,#ffeb3b 100%); }
        .progress-fill.not-done { background: linear-gradient(90deg,#ef5350 0%,#e53935 100%); }

        .tabs { display:flex; background: #f5f5f5; border-bottom: 2px solid #ddd; }
        .tab { flex:1; padding:15px; text-align:center; cursor:pointer; background:#f5f5f5; border:none; font-size:15px; font-weight:500; transition:all 0.3s; }
        .tab:hover { background:#ebebeb; }
        .tab.active { background:white; border-bottom:3px solid #c41e3a; }

        /* Layout change: main area + sidebar */
        .content {
            display: flex;
            gap: 24px;
            padding: 30px;
        }

        .main-area {
            flex: 1 1 0;
            min-width: 0;
        }

        .sidebar {
            width: 320px;
            max-width: 32%;
            background: #fafafa;
            border-left: 1px solid #eee;
            padding: 18px;
            border-radius: 6px;
            align-self: flex-start;
            height: fit-content;
        }

        /* Keep existing components styling mostly intact */
        .course-list { margin-bottom: 20px; }
        .section-title { font-size: 16px; font-weight:600; margin-bottom: 15px; }
        .course-item { display:flex; justify-content:space-between; align-items:center; padding:15px; background:#f9f9f9; margin-bottom:10px; border-radius:4px; border-left:4px solid #c41e3a; }
        .course-info { flex:1; }
        .course-code { font-weight:600; font-size:14px; margin-bottom:4px; }
        .course-credits { font-size:13px; color:#666; }
        .course-status { padding:6px 16px; background:white; border:1px solid #ddd; border-radius:4px; font-size:13px; }

        .requirement-card { background:#f9f9f9; padding:20px; margin-bottom:15px; border-radius:4px; border-left:4px solid #c41e3a; }
        .requirement-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
        .requirement-title { font-weight:600; font-size:15px; }
        .view-btn { padding:8px 20px; background:#c41e3a; color:white; border:none; border-radius:4px; cursor:pointer; font-size:13px; font-weight:500; }
        .view-btn:hover { background:#a01629; }

        .requirement-progress { height:8px; background:#e0e0e0; border-radius:4px; overflow:hidden; }

        .year-section { margin-bottom: 30px; }
        .year-title { font-weight:600; font-size:15px; margin-bottom:15px; color:#333; }

        .course-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .course-box {
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-size: 13px;
            font-weight: 700;
            border: 1px solid rgba(0,0,0,0.06);
            background: #f5f5f5;
            min-height: 52px;
            display:flex;
            align-items:center;
            justify-content:center;
            position:relative;
            transition: transform 0.12s ease, box-shadow 0.12s ease;
            user-select: none;
        }

        .course-box:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,0.04); }

        .course-box.green { background:#a5d6a7; border-left: 4px solid #4caf50; color: #114d1a;}
        .course-box.yellow { background:#ffeb3b; border-left: 4px solid #f9a825; color: #5a4b00; }
        .course-box.red { background:#ef9a9a; border-left: 4px solid #e53935; color: #5a1a1a; }
        .course-box.slot { background: #fff; border: 1px dashed rgba(0,0,0,0.08); color: #666; border-left:4px solid transparent; }

        .course-box.highlight {
            outline: 3px dashed rgba(196,30,58,0.45);
            transform: translateY(-3px);
        }

        .elective-item { display:flex; justify-content:space-between; align-items:center; padding:15px; margin-bottom:10px; border-radius:4px; }
        .elective-item.completed { background:#c8e6c9; border-left:4px solid #4caf50; }
        .elective-item.incomplete { background:#ffcdd2; border-left:4px solid #e53935; }
        .elective-code { font-weight:600; font-size:14px; }
        .elective-credits { font-size:13px; color:#555; margin-top:2px; }
        .elective-status { font-size:13px; font-weight:500; }

        .completion-summary { background:#f9f9f9; padding:15px; border-radius:4px; border-left:4px solid #c41e3a; display:flex; justify-content:space-between; align-items:center; font-weight:600; }

        .return-link { color:#c41e3a; text-decoration:none; font-size:14px; font-weight:500; }
        .return-link:hover { text-decoration:underline; }

        .advising-section { background:white; padding:20px; border-radius:4px; margin-bottom:20px; }

        /* Sidebar search specific */
        .search-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
        .search-title { font-weight:600; font-size:16px; color:#c41e3a; }
        .search-input { width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; font-size:14px; margin-bottom:12px; }
        .search-results { max-height: 52vh; overflow:auto; display:flex; flex-direction:column; gap:8px; }
        .search-item {
            background:white; border:1px solid #eee; padding:10px 12px; border-radius:6px; cursor:grab; display:flex; justify-content:space-between; align-items:center;
        }
        .search-item:active { cursor:grabbing; }
        .search-code { font-weight:700; font-size:13px; }
        .search-prereqs { font-size:12px; color:#666; }

        .small-note { font-size:12px; color:#666; margin-top:10px; }

        .hidden { display:none; }

        /* modal & other styles remain */
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center; }
        .modal.active { display:flex; }
        .modal-content { background:white; padding:30px; border-radius:8px; max-width:400px; width:90%; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,0.3); }
        .modal-title { font-size:20px; font-weight:600; margin-bottom:15px; color:#4caf50; }
        .modal-message { font-size:14px; color:#666; margin-bottom:20px; line-height:1.5; }
        .modal-close-btn { padding:10px 30px; background:#c41e3a; color:white; border:none; border-radius:4px; cursor:pointer; font-size:14px; font-weight:500; }
        .modal-close-btn:hover { background:#a01629; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è University of Calgary</h1>
            <span class="header-title">Academic planning and Course Advising Navigator</span>
        </div>

        <div class="student-banner">
            <div class="student-info">
                <div>
                    <div class="student-name">John Doe</div>
                    <div class="student-details">Software Engineering - 2nd year - ID: 30174478</div>
                </div>
                <div class="gpa-info">
                    <div class="gpa">GPA: 0.67</div>
                    <div class="credits">41/67 credits</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill completed" id="completedProgress"></div>
                <div class="progress-fill in-progress" id="inProgressProgress"></div>
                <div class="progress-fill not-done" id="notDoneProgress"></div>
            </div>
            <div style="margin-top:8px; font-size:13px;" id="progressText">Overall degree progress:</div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">Overview</button>
            <button class="tab" onclick="showTab('requirements')">Requirements</button>
            <button class="tab" onclick="showTab('advising')">Advising</button>
        </div>

        <div class="content">
            <div class="main-area">
                <div id="overview-content">
                    <div class="course-list">
                        <div class="section-title">Current semester Courses:</div>
                        <div style="font-size:13px; color:#666; margin-bottom:15px;">12 credits enrolled/in progress</div>
                        
                        <div class="course-item">
                            <div class="course-info">
                                <div class="course-code">ENSP 67</div>
                                <div class="course-credits">3 Credits</div>
                            </div>
                            <div class="course-status">Enrolled</div>
                        </div>

                        <div class="course-item">
                            <div class="course-info">
                                <div class="course-code">ENGF 41</div>
                                <div class="course-credits">3 Credits</div>
                            </div>
                            <div class="course-status">Enrolled</div>
                        </div>

                        <div class="course-item">
                            <div class="course-info">
                                <div class="course-code">COMS 367</div>
                                <div class="course-credits">3 Credits</div>
                            </div>
                            <div class="course-status">Enrolled</div>
                        </div>

                        <div class="course-item">
                            <div class="course-info">
                                <div class="course-code">RELS 341</div>
                                <div class="course-credits">3 Credits</div>
                            </div>
                            <div class="course-status">Enrolled</div>
                        </div>
                    </div>
                </div>

                <div id="requirements-content" class="hidden">
                    <div class="section-title">Major Requirements: Software Engineering</div>
                    
                    <div class="requirement-card">
                        <div class="requirement-header">
                            <div class="requirement-title">Major Requirements: Software Engineering</div>
                            <button class="view-btn" onclick="showMajorRequirements()">View</button>
                        </div>
                        <div class="requirement-progress">
                            <div class="progress-bar">
                                <div class="progress-fill completed" id="majorCompletedProgress"></div>
                                <div class="progress-fill in-progress" id="majorInProgressProgress"></div>
                                <div class="progress-fill not-done" id="majorNotDoneProgress"></div>
                            </div>
                        </div>
                    </div>

                    <div class="requirement-card">
                        <div class="requirement-header">
                            <div class="requirement-title">Minor Requirements: Mechatronics Engineering</div>
                            <button class="view-btn" onclick="showMinorRequirements()">View</button>
                        </div>
                        <div class="requirement-progress">
                            <div class="progress-bar">
                                <div class="progress-fill completed" id="minorCompletedProgress"></div>
                                <div class="progress-fill in-progress" id="minorInProgressProgress"></div>
                                <div class="progress-fill not-done" id="minorNotDoneProgress"></div>
                            </div>
                        </div>
                    </div>

                    <div class="requirement-card">
                        <div class="requirement-header">
                            <div class="requirement-title">Technical Electives</div>
                            <button class="view-btn" onclick="showTechnicalElectives()">View</button>
                        </div>
                        <div class="requirement-progress">
                            <div class="progress-bar">
                                <div class="progress-fill completed" id="techCompletedProgress"></div>
                                <div class="progress-fill in-progress" id="techInProgressProgress"></div>
                                <div class="progress-fill not-done" id="techNotDoneProgress"></div>
                            </div>
                        </div>
                    </div>

                    <div class="requirement-card">
                        <div class="requirement-header">
                            <div class="requirement-title">COST Electives</div>
                            <button class="view-btn" onclick="showCOSTElectives()">View</button>
                        </div>
                        <div class="requirement-progress">
                            <div class="progress-bar">
                                <div class="progress-fill completed" id="costCompletedProgress"></div>
                                <div class="progress-fill in-progress" id="costInProgressProgress"></div>
                                <div class="progress-fill not-done" id="costNotDoneProgress"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="major-requirements-content" class="hidden">
                    <div style="margin-bottom:20px;">
                        <a href="#" class="return-link" onclick="showTab('requirements'); return false;">‚Üê Return</a>
                    </div>
                    
                    <div class="section-title">Major Requirements: Software Engineering</div>

                    <!-- Year 1 -->
                    <div class="year-section">
                        <div class="year-title">Year: 1st</div>
                        <div class="course-grid" id="grid-year1">
                            <!-- these boxes will be initialised by JS (and slots added if fewer than 5) -->
                            <div class="course-box green" data-course="CHEM 209">CHEM 209</div>
                            <div class="course-box green" data-course="ENDG 233">ENDG 233</div>
                            <div class="course-box green" data-course="MATH 275">MATH 275</div>
                            <div class="course-box green" data-course="MATH 211">MATH 211</div>
                            <div class="course-box green" data-course="ENGG 225">ENGG 225</div>
                        </div>

                        <div class="course-grid" id="grid-year1-row2">
                            <div class="course-box green" data-course="ENGG 201">ENGG 201</div>
                            <div class="course-box green" data-course="ENGG 202">ENGG 202</div>
                            <div class="course-box green" data-course="MATH 277">MATH 277</div>
                            <div class="course-box green" data-course="PHYS 259">PHYS 259</div>
                            <div class="course-box green" data-course="ENGG 200">ENGG 200</div>
                        </div>
                    </div>

                    <!-- Year 2 -->
                    <div class="year-section">
                        <div class="year-title">Year: 2nd</div>
                        <div class="course-grid" id="grid-year2">
                            <div class="course-box green" data-course="ENDG 319">ENDG 319</div>
                            <div class="course-box green" data-course="ENSF 300">ENSF 300</div>
                            <div class="course-box green" data-course="MATH 375">MATH 375</div>
                            <div class="course-box green" data-course="ENSF 337">ENSF 337</div>
                            <div class="course-box green" data-course="ENEL 353">ENEL 353</div>
                        </div>

                        <div class="course-grid" id="grid-year2-row2">
                            <div class="course-box green" data-course="MATH 271">MATH 271</div>
                            <div class="course-box green" data-course="ENSF 338">ENSF 338</div>
                            <div class="course-box green" data-course="ENSF 380">ENSF 380</div>
                            <div class="course-box green" data-course="ENSF 381">ENSF 381</div>
                            <div class="course-box green" data-course="ENCM 369">ENCM 369</div>
                        </div>
                    </div>

                    <!-- Year 3 -->
                    <div class="year-section">
                        <div class="year-title">Year: 3rd</div>
                        <div class="course-grid" id="grid-year3">
                            <div class="course-box yellow" data-course="ENSF 460">ENSF 460</div>
                            <div class="course-box yellow" data-course="ENSF 461">ENSF 461</div>
                            <div class="course-box yellow" data-course="ENSF 462">ENSF 462</div>
                            <div class="course-box yellow" data-course="ENSF 480">ENSF 480</div>
                            <div class="course-box yellow" data-course="ENME 461">ENME 461</div>
                        </div>

                        <div class="course-grid" id="grid-year3-row2">
                            <div class="course-box yellow" data-course="ENSF 400">ENSF 400</div>
                            <div class="course-box yellow" data-course="ENSF 444">ENSF 444</div>
                            <div class="course-box yellow" data-course="SENG 401">SENG 401</div>
                            <div class="course-box yellow" data-course="SENG 438">SENG 438</div>
                            <div class="course-box yellow" data-course="ENEL 441">ENEL 441</div>
                        </div>
                    </div>

                    <!-- Year 4 -->
                    <div class="year-section">
                        <div class="year-title">Year: 4th</div>
                        <div class="course-grid" id="grid-year4">
                            <div class="course-box red" data-course="ENEL 500A">ENEL 500A</div>
                            <div class="course-box red" data-course="SENG 511">SENG 511</div>
                            <div class="course-box red" data-course="ENME 561">ENME 561</div>
                            <div class="course-box red" data-course="ENEL 500B">ENEL 500B</div>
                            <div class="course-box red" data-course="SENG 533">SENG 533</div>
                        </div>

                        <div class="course-grid" id="grid-year4-row2">
                            <div class="course-box yellow" data-course="">COST Option</div>
                            <div class="course-box yellow" data-course="">COST Option</div>
                            <div class="course-box yellow" data-course="">COST Option</div>
                            <div class="course-box yellow" data-course="">COST Option</div>
                            <div class="course-box yellow" data-course="">COST Option</div>
                        </div>
                    </div>
                </div>

                <div id="minor-requirements-content" class="hidden">
                    <div style="margin-bottom:20px;">
                        <a href="#" class="return-link" onclick="showTab('requirements'); return false;">‚Üê Return</a>
                    </div>
                    
                    <div class="section-title">Minor: Mechatronics Engineering</div>

                    <div class="elective-item completed">
                        <div>
                            <div class="elective-code">ENME 327</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Completed</div>
                            <button class="view-btn" onclick="openPrerequisites('ENME 327')">View</button>
                        </div>
                    </div>

                    <div class="elective-item completed">
                        <div>
                            <div class="elective-code">ENEL 301</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Completed</div>
                            <button class="view-btn" onclick="openPrerequisites('ENEL 301')">View</button>
                        </div>
                    </div>

                    <div class="elective-item incomplete">
                        <div>
                            <div class="elective-code">ENME 455</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Incomplete</div>
                            <button class="view-btn" onclick="openPrerequisites('ENME 455')">View</button>
                        </div>
                    </div>

                    <div class="elective-item incomplete">
                        <div>
                            <div class="elective-code">ENME 527</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Incomplete</div>
                            <button class="view-btn" onclick="openPrerequisites('ENME 527')">View</button>
                        </div>
                    </div>

                    <div class="completion-summary">
                        <span>Completed</span>
                        <span>6/12 Credits</span>
                    </div>
                </div>

                <div id="technical-electives-content" class="hidden">
                    <div style="margin-bottom:20px;">
                        <a href="#" class="return-link" onclick="showTab('requirements'); return false;">‚Üê Return</a>
                    </div>
                    
                    <div class="section-title">Technical Electives</div>

                    <div class="elective-item incomplete">
                        <div>
                            <div class="elective-code">TECH 401</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Incomplete</div>
                            <button class="view-btn" onclick="openPrerequisites('TECH 401')">View</button>
                        </div>
                    </div>

                    <div class="elective-item incomplete">
                        <div>
                            <div class="elective-code">TECH 402</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Incomplete</div>
                            <button class="view-btn" onclick="openPrerequisites('TECH 402')">View</button>
                        </div>
                    </div>

                    <div class="elective-item incomplete">
                        <div>
                            <div class="elective-code">TECH 403</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Incomplete</div>
                            <button class="view-btn" onclick="openPrerequisites('TECH 403')">View</button>
                        </div>
                    </div>

                    <div class="completion-summary">
                        <span>Completed</span>
                        <span>0/9 Credits</span>
                    </div>
                </div>

                <div id="cost-electives-content" class="hidden">
                    <div style="margin-bottom:20px;">
                        <a href="#" class="return-link" onclick="showTab('requirements'); return false;">‚Üê Return</a>
                    </div>
                    
                    <div class="section-title">COST Electives</div>

                    <div class="elective-item completed">
                        <div>
                            <div class="elective-code">COST 201</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Completed</div>
                            <button class="view-btn" onclick="openPrerequisites('COST 201')">View</button>
                        </div>
                    </div>

                    <div class="elective-item completed">
                        <div>
                            <div class="elective-code">COST 305</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Completed</div>
                            <button class="view-btn" onclick="openPrerequisites('COST 305')">View</button>
                        </div>
                    </div>

                    <div class="elective-item completed">
                        <div>
                            <div class="elective-code">COST 412</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Completed</div>
                            <button class="view-btn" onclick="openPrerequisites('COST 412')">View</button>
                        </div>
                    </div>

                    <div class="elective-item completed">
                        <div>
                            <div class="elective-code">COST 450</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Completed</div>
                            <button class="view-btn" onclick="openPrerequisites('COST 450')">View</button>
                        </div>
                    </div>

                    <div class="elective-item completed">
                        <div>
                            <div class="elective-code">COST 491</div>
                            <div class="elective-credits">2 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Completed</div>
                            <button class="view-btn" onclick="openPrerequisites('COST 491')">View</button>
                        </div>
                    </div>

                    <div class="elective-item incomplete">
                        <div>
                            <div class="elective-code">COST 510</div>
                            <div class="elective-credits">3 Credits</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div class="elective-status">Incomplete</div>
                            <button class="view-btn" onclick="openPrerequisites('COST 510')">View</button>
                        </div>
                    </div>

                    <div class="completion-summary">
                        <span>Completed</span>
                        <span>14/17 Credits</span>
                    </div>
                </div>

                <div id="advising-content" class="hidden">
                    <div class="advising-section">
                        <div class="appointment-header">
                            <div class="appointment-title">Appointment</div>
                        </div>

                        <input type="date" class="date-input" value="2025-08-17">

                        <div class="time-slots">
                            <div class="section-title" style="margin-bottom:15px;">Available Time Slots</div>
                            
                            <div class="time-slot available" onclick="selectTimeSlot(this,'9:00 AM - 10:00 AM')">
                                <span class="time-label">9:00 AM - 10:00 AM</span>
                                <span class="slot-status">Available</span>
                            </div>
                            
                            <div class="time-slot available" onclick="selectTimeSlot(this,'10:00 AM - 11:00 AM')">
                                <span class="time-label">10:00 AM - 11:00 AM</span>
                                <span class="slot-status">Available</span>
                            </div>
                            
                            <div class="time-slot booked">
                                <span class="time-label">11:00 AM - 12:00 PM</span>
                                <span class="slot-status">Booked</span>
                            </div>
                            
                            <div class="time-slot available" onclick="selectTimeSlot(this,'12:00 PM - 1:00 PM')">
                                <span class="time-label">12:00 PM - 1:00 PM</span>
                                <span class="slot-status">Available</span>
                            </div>
                            
                            <div class="time-slot booked">
                                <span class="time-label">1:00 PM - 2:00 PM</span>
                                <span class="slot-status">Booked</span>
                            </div>
                            
                            <div class="time-slot available" onclick="selectTimeSlot(this,'2:00 PM - 3:00 PM')">
                                <span class="time-label">2:00 PM - 3:00 PM</span>
                                <span class="slot-status">Available</span>
                            </div>
                            
                            <div class="time-slot available" onclick="selectTimeSlot(this,'3:00 PM - 4:00 PM')">
                                <span class="time-label">3:00 PM - 4:00 PM</span>
                                <span class="slot-status">Available</span>
                            </div>
                            
                            <div class="time-slot booked">
                                <span class="time-label">4:00 PM - 5:00 PM</span>
                                <span class="slot-status">Booked</span>
                            </div>
                        </div>

                        <div class="reason-section">
                            <div class="reason-title">Reason for Advising</div>
                            <textarea class="reason-input" id="advisingReason" placeholder="Enter your reason for advising..."></textarea>
                        </div>

                        <div style="text-align:center; margin-top:20px;">
                            <button class="book-btn" onclick="bookAppointment()">Book Appointment</button>
                        </div>
                    </div>
                </div>
            </div>

            <aside class="sidebar" id="courseSidebar">
                <div class="search-header">
                    <div class="search-title">Course Search</div>
                    <div style="font-size:12px;color:#666;">Drag to replace</div>
                </div>

                <input id="courseSearch" class="search-input" placeholder="Search courses (e.g. ENGG 225)" />

                <div class="search-results" id="searchResults"></div>

                <div class="small-note">Tip: drag a result onto any course box to replace it. Click a box to view prerequisites.</div>
            </aside>
        </div>
    </div>

    <div class="modal" id="bookingModal">
        <div class="modal-content">
            <div class="modal-title">‚úì Appointment Booked!</div>
            <div class="modal-message" id="modalMessage"></div>
            <button class="modal-close-btn" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script>

        const completedCourses = [
            "CHEM 209","ENDG 233","MATH 275","MATH 211","ENGG 225",
            "ENGG 201","ENGG 202","MATH 277","PHYS 259","ENGG 200",
            "ENDG 319","ENSF 300","MATH 375","ENSF 337","ENEL 353",
            "MATH 271","ENCM 369","ENEL 327","ENEL 301","COST 201",
            "COST 305","COST 412","COST 450"
        ];


        const prereqs = {
            'PHYS 259': [ 'MATH 211', 'MATH 275' ],
            'MATH 277': [ 'MATH 275' ],
            'ENDG 319': [ 'ENDG 233', 'MATH 277' ],
            'ENSF 300': [ 'ENDG 233' ],
            'MATH 375': [ 'MATH 277' ],
            'ENSF 337': [ 'ENDG 233' ],
            'MATH 271': [ 'MATH 211' ],
            'ENSF 338': [ 'ENSF 300', 'ENSF 337' ],
            'ENSF 380': [ 'ENSF 300', 'ENSF 337' ],
            'ENSF 381': [ 'ENSF 300', 'ENSF 337' ],
            'ENCM 369': [ 'ENEL 353', 'ENSF 337' ],
            'ENEL 327': [ 'MATH 375' ],
            'ENGG 349': [ 'ENGG 202' ],
            'ENSF 460': [ 'ENCM 369' ],
            'ENSF 461': [ 'ENSF 338', 'ENCM 369' ],
            'ENSF 480': [ 'ENSF 338', 'ENCM 369' ],
            'ENME 461': [ 'ENGG 349', 'ENGG 225' ],
            'ENSF 400': [ 'ENSF 300' ],
            'ENSF 444': [ 'ENSF 300', 'ENSF 337' ],
            'ENSF 401': [ 'ENSF 338' ],
            'ENSF 438': [ 'ENSF 338' ],
            'ENEL 441': [ 'ENEL 327' ],
            'SENG 511': [ 'ENSF 480' ],
            'ENME 561': [ 'ENME 461' ],
            'ENEL 500B': [ 'ENEL 500A' ],
            'SENG 533': [ 'ENSF 480', 'ENSF 461' ],
            'ENEL 301': [ 'ENEL 201', 'ENGG 233', 'ENGG 225' ],
            'ENME 327': [ 'ENEL 301', 'ENME 300' ],
            'ENME 455': [ 'ENEL 255' ],
            'ENME 527': [ 'ENME 455' ],
            'COST 305': [ 'COST 201' ],
            'COST 412': [ 'COST 305' ],
            'COST 450': [ 'COST 412' ],
            'COST 491': [ 'COST 450' ],
            'COST 510': [ 'COST 491' ],
            'CHEM 209': [],
            'ENDG 233': [],
            'MATH 275': [],
            'MATH 211': [],
            'ENGG 225': [],
            'ENGG 201': [],
            'ENGG 202': [],
            'ENGG 200': [],
            'ENSF 300': [],
            'ENEL 353': []

        };

        function prerequisitesSatisfied(courseCode) {
            const list = prereqs[courseCode];
            if (!list || list.length === 0) return true; // no prereqs -> satisfied
            return list.every(c => completedCourses.includes(c));
        }


        function collectKnownCourses() {
            const set = new Set();
            document.querySelectorAll('.course-box').forEach(box => {
                const code = box.dataset.course;
                if (code) set.add(code.trim());
            });
            Object.keys(prereqs).forEach(c => set.add(c));
            Object.values(prereqs).flat().forEach(c => set.add(c));
            return Array.from(set).sort();
        }

        function renderSearchList(filter = '') {
            const results = document.getElementById('searchResults');
            results.innerHTML = '';
            const courses = collectKnownCourses().filter(c => c.toLowerCase().includes(filter.toLowerCase()));
            courses.forEach(code => {
                const div = document.createElement('div');
                div.className = 'search-item';
                div.draggable = true;
                div.dataset.course = code;
                div.innerHTML = `<div style="display:flex;flex-direction:column;align-items:flex-start;">
                                    <div class="search-code">${code}</div>
                                    <div class="search-prereqs">${(prereqs[code] && prereqs[code].length) ? 'Pre: ' + prereqs[code].join(', ') : 'No prereqs'}</div>
                                </div>
                                <div style="font-size:12px;color:#c41e3a;font-weight:700;">DRAG</div>`;
                div.addEventListener('dragstart', (ev) => {
                    ev.dataTransfer.setData('text/plain', code);
                    ev.dataTransfer.effectAllowed = 'move';
                });
                results.appendChild(div);
            });
            if (courses.length === 0) {
                results.innerHTML = `<div style="color:#666; font-size:13px;">No matches</div>`;
            }
        }

        document.getElementById('courseSearch').addEventListener('input', (e) => {
            renderSearchList(e.target.value);
        });

        function makeBoxesDroppable() {
            const grids = document.querySelectorAll('.course-grid');
            grids.forEach(grid => {
                // add slot boxes until there are 5 slots
                while (grid.children.length < 5) {
                    const slot = document.createElement('div');
                    slot.className = 'course-box slot';
                    slot.dataset.course = '';
                    slot.textContent = 'SLOT';
                    grid.appendChild(slot);
                }

                Array.from(grid.children).forEach(box => {
                    box.setAttribute('draggable', 'false');
                    
                    box.addEventListener('click', () => {
                        const course = box.dataset.course || box.textContent.trim();
                        if (!course || course === 'SLOT') return;
                        window.open(`prerequisites.html?course=${encodeURIComponent(course)}`, '_blank');
                    });

                    box.addEventListener('dragenter', (e) => {
                        e.preventDefault();
                        box.classList.add('highlight');
                    });
                    box.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'move';
                    });
                    box.addEventListener('dragleave', (e) => {
                        box.classList.remove('highlight');
                    });
                    box.addEventListener('drop', (e) => {
                        e.preventDefault();
                        box.classList.remove('highlight');
                        const code = e.dataTransfer.getData('text/plain') || e.dataTransfer.getData('text');
                        if (!code) return;
                        applyCourseToBox(box, code.trim());
                        saveMajorGridState();
                        renderSearchList(document.getElementById('courseSearch').value);
                    });
                });
            });
        }

        function applyCourseToBox(box, courseCode) {
            box.textContent = courseCode;
            box.dataset.course = courseCode;

            if (prerequisitesSatisfied(courseCode)) {
                box.classList.remove('red', 'yellow', 'slot');
                box.classList.add('green');
            } else {
                box.classList.remove('green', 'yellow', 'slot');
                box.classList.add('red');
            }

            // if course has no prereqs and not in prereqs object, default to green
            if (!prereqs[courseCode]) {
                // treat unknown course as no prereqs
                box.classList.remove('red', 'yellow', 'slot');
                box.classList.add('green');
            }

            // ensure clicking opens prereqs page
            box.onclick = () => {
                const course = box.dataset.course || box.textContent.trim();
                if (!course || course === 'SLOT') return;
                window.open(`prerequisites.html?course=${encodeURIComponent(course)}`, '_blank');
            };
        }

        window.addEventListener('DOMContentLoaded', () => {

            const totalCredits = 67;
            const completedCredits = 41;
            const inProgressCredits = 12;
            const notDoneCredits = totalCredits - completedCredits - inProgressCredits;
            const completedPercent = (completedCredits / totalCredits) * 100;
            const inProgressPercent = (inProgressCredits / totalCredits) * 100;
            const notDonePercent = (notDoneCredits / totalCredits) * 100;
            document.getElementById('completedProgress').style.width = completedPercent + '%';
            document.getElementById('inProgressProgress').style.width = inProgressPercent + '%';
            document.getElementById('notDoneProgress').style.width = notDonePercent + '%';
            document.getElementById('progressText').textContent = `Overall degree progress: ${Math.round(completedPercent)}% completed`;

            document.querySelectorAll('.course-box').forEach(box => {
                const code = box.dataset.course;
                if (!code || code === 'SLOT') {
                    box.classList.add('slot');
                    box.textContent = box.textContent.trim() || 'SLOT';
                } else {
                    if (!box.classList.contains('green') && !box.classList.contains('red') && !box.classList.contains('yellow')) {
                        if (prerequisitesSatisfied(code)) box.classList.add('green');
                        else box.classList.add('red');
                    }
                }
            });

            makeBoxesDroppable();
            renderSearchList();
        });

        function showTab(tabName) {
            const sections = [
                'overview-content',
                'requirements-content',
                'advising-content',
                'major-requirements-content',
                'minor-requirements-content',
                'technical-electives-content',
                'cost-electives-content'
            ];
            sections.forEach(id => document.getElementById(id).classList.add('hidden'));

            if (tabName === 'overview') document.getElementById('overview-content').classList.remove('hidden');
            if (tabName === 'requirements') document.getElementById('requirements-content').classList.remove('hidden');
            if (tabName === 'advising') document.getElementById('advising-content').classList.remove('hidden');

            // update tab active class
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.tab[onclick="showTab('${tabName}')"]`)?.classList.add('active');

            const sidebar = document.getElementById('courseSidebar');
            if (tabName === 'major-requirements') {
                sidebar.classList.remove('hidden');
            } else {
                sidebar.classList.add('hidden');
            }
        }


        function showMajorRequirements() {
            document.getElementById('requirements-content').classList.add('hidden');
            document.getElementById('major-requirements-content').classList.remove('hidden');
            updateSidebarVisibility();
            makeBoxesDroppable();
            restoreMajorGridState();
            makeBoxesDroppable();
            updateSidebarVisibility();

        }

        function showMinorRequirements() {
            document.getElementById('requirements-content').classList.add('hidden');
            document.getElementById('minor-requirements-content').classList.remove('hidden');
        }

        function showTechnicalElectives() {
            document.getElementById('requirements-content').classList.add('hidden');
            document.getElementById('technical-electives-content').classList.remove('hidden');
        }

        function showCOSTElectives() {
            document.getElementById('requirements-content').classList.add('hidden');
            document.getElementById('cost-electives-content').classList.remove('hidden');
        }

        function openPrerequisites(courseCode) {
            window.open(`prerequisites.html?course=${encodeURIComponent(courseCode)}`, '_blank');
        }

        /* Advising booking modal logic preserved from original file */
        let selectedTimeSlot = null;
        function selectTimeSlot(element, timeSlot) {
            const allSlots = document.querySelectorAll('.time-slot.available');
            allSlots.forEach(slot => {
                slot.style.border = 'none';
                slot.style.borderLeft = '4px solid #4caf50';
            });
            element.style.border = '3px solid #c41e3a';
            element.style.borderLeft = '4px solid #4caf50';
            selectedTimeSlot = timeSlot;
        }

        function bookAppointment() {
            const reason = document.getElementById('advisingReason').value.trim();
            const date = document.querySelector('.date-input').value;
            if (!selectedTimeSlot) { alert('Please select a time slot first.'); return; }
            if (!reason) { alert('Please enter a reason for advising.'); return; }
            const formattedDate = new Date(date).toLocaleDateString('en-US', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });
            document.getElementById('modalMessage').innerHTML =
                `Your appointment has been successfully booked for:<br><br>
                <strong>${formattedDate}</strong><br>
                <strong>${selectedTimeSlot}</strong><br><br>
                You will receive a confirmation email shortly.`;
            document.getElementById('bookingModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('bookingModal').classList.remove('active');
            document.getElementById('advisingReason').value = '';
            selectedTimeSlot = null;
            const allSlots = document.querySelectorAll('.time-slot.available');
            allSlots.forEach(slot => {
                slot.style.border = 'none';
                slot.style.borderLeft = '4px solid #4caf50';
            });
        }

        function updateSidebarVisibility() {
            const sidebar = document.getElementById("courseSidebar");
            const majorPageVisible = !document.getElementById("major-requirements-content").classList.contains("hidden");
            sidebar.style.display = majorPageVisible ? "block" : "none";
        }
        function saveMajorGridState() {
            const grids = document.querySelectorAll("#major-requirements-content .course-grid");
            const state = [];

            grids.forEach(grid => {
                const row = [];
                grid.querySelectorAll(".course-box").forEach(box => {
                    row.push({
                        course: box.dataset.course || "",
                        classes: box.className
                    });
                });
                state.push(row);
            });

            sessionStorage.setItem("majorGridState", JSON.stringify(state));
        }

        function restoreMajorGridState() {
            const saved = sessionStorage.getItem("majorGridState");
            if (!saved) return;

            const state = JSON.parse(saved);
            const grids = document.querySelectorAll("#major-requirements-content .course-grid");

            grids.forEach((grid, i) => {
                const rowState = state[i];
                if (!rowState) return;

                const boxes = grid.querySelectorAll(".course-box");

                boxes.forEach((box, j) => {
                    const savedBox = rowState[j];
                    if (!savedBox) return;

                    box.dataset.course = savedBox.course;
                    box.textContent = savedBox.course || "SLOT";
                    box.className = savedBox.classes;
                });
            });
        }
        window.addEventListener("pageshow", (event) => {
            if (event.persisted) {
                restoreMajorGridState();
                updateSidebarVisibility();
            }
        });

    </script>
</body>
</html>
